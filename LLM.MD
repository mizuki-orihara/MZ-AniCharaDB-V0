# =========================================================

# animdb : LLM向け メタデータ定義ファイル

# =========================================================

# 目的：

# ・本システムの思想・制約・運用前提を LLM に正確に伝える

# ・誤った自動化や推測を防止する

# ・人間中心のワークフローを維持する

# =========================================================



system:

  名称: animdb

  種別: ファイルベースJSON管理システム

  主用途: アニメ・作品キャラクター情報の管理

  自動化レベル: 半自動（人手介在前提）



# ---------------------------------------------------------

# 運用前提（非常に重要）

# ---------------------------------------------------------

運用前提:

  同時実行:

    マルチスレッド: false

    並列ワーカー: 想定しない

  運用者:

    人数: 1名

    想定スキル: 技術者1名による手動管理

  実行環境:

    想定ハードウェア:

      - Raspberry Pi

      - Core2Duo世代ノートPC

    高負荷環境: 想定しない



# LLMへの明示的注意

LLM注意事項:

  - 並列処理・分散処理・クラスタ構成を仮定してはならない

  - 高性能サーバー前提の最適化を提案してはならない



# ---------------------------------------------------------

# データ哲学

# ---------------------------------------------------------

データ設計思想:

  データベース使用: false

  永続データ: JSONファイル

  キャッシュ扱い:

    - import_cache 以下は破棄可能

  真実の所在:

    authoritative_state: task_master.json



# ---------------------------------------------------------

# 中央制御オブジェクト

# ---------------------------------------------------------

中央制御:

  制御ファイル: task_master.json

  役割:

    - ゲート制御（工程ごとの実行可否）

    - 論理ロック管理

    - システム状態の可視化

  原則:

    - task_master.json が常に最優先

    - 矛盾があれば task_master を正とする



# ゲート制御ルール

ゲート制御規則:

  gate_open:

    意味: 「その工程が作業を開始してよいか」

    変更権限:

      - 人間の運用者

      - controller プロセス

    禁止事項:

      - worker（各工程PHP）がゲートを変更してはならない



# ---------------------------------------------------------

# ワークフロー（論理段階）

# ---------------------------------------------------------

ワークフロー:

  段階:

    - receiver: JSONを受信する

    - processor: 構文・スキーマを検証する

    - dispatcher: 登録先を判断する

    - merge_standby: 人手確認を待つ

    - register: MainDBへ登録する

    - indexer: 索引を再構築する



  注意:

    - これらは論理的段階であり、必ずしも1ファイル=1段階ではない



# ---------------------------------------------------------

# 人手介在ポリシー

# ---------------------------------------------------------

人手介在:

  必須:

    - マージ判断

    - 競合解決

    - ゲート開閉操作

  任意:

    - indexer 実行タイミング

  LLM制約:

    - マージを自動確定してはならない

    - 実行ではなく「提案」に留めること



# ---------------------------------------------------------

# エラーと安全設計

# ---------------------------------------------------------

エラー処理方針:

  優先順位:

    1: 処理を止める

    2: データを保存する

    3: 人に通知する

  自動復旧:

    有効: false



# LLMへの明示指針

安全指針:

  - 推測による補完は禁止

  - 不明な値は null とする

  - 「止める判断」を最優先する



# ---------------------------------------------------------

# ステータス・統計

# ---------------------------------------------------------

ステータス設計:

  目的:

    - スループット把握

    - エラー傾向分析

    - 手動運用の補助

  精度:

    - 厳密性より傾向重視



# ---------------------------------------------------------

# JSONスキーマ運用ルール

# ---------------------------------------------------------

JSONスキーマ:

  プレフィックス: MiZu_Character_Profile

  形式: "_v{1〜99}.{YYMM}.{連番2桁}"

  欠損値:

    許可: true

    表現: null

  推測ポリシー:

    推測禁止: true



# ---------------------------------------------------------

# LLMの役割定義

# ---------------------------------------------------------

LLM役割:

  許可:

    - スキーマ検証補助

    - 差分内容の説明

    - マージ候補の提案

    - ドキュメント生成

  禁止:

    - MainDB の直接変更

    - 自動マージ実行

    - ゲート操作



# ---------------------------------------------------------

# 要約（コンテキスト用）

# ---------------------------------------------------------

要約: >

  animdb は、単一運用者・低スペック環境を前提とした

  ファイルベースのJSON管理システムである。

  自動化よりも人の判断と安全性を重視し、

  task_master.json を唯一の制御中枢として

  すべての工程がこれに従う。